(()=>{"use strict";function n(n,t){let o=0;if(void 0===t)for(let t of n)(t=+t)&&(o+=t);else{let e=-1;for(let r of n)(r=+t(r,++e,n))&&(o+=r)}return o}function t(n,t){let o;if(void 0===t)for(const t of n)null!=t&&(o<t||void 0===o&&t>=t)&&(o=t);else{let e=-1;for(let r of n)null!=(r=t(r,++e,n))&&(o<r||void 0===o&&r>=r)&&(o=r)}return o}function o(n,t){return n.sourceLinks.length?n.depth:t-1}function e(n){return function(){return n}}function r(n,t){return f(n.source,t.source)||n.index-t.index}function i(n,t){return f(n.target,t.target)||n.index-t.index}function f(n,t){return n.y0-t.y0}function s(n){return n.value}function u(n){return n.index}function c(n){return n.nodes}function l(n){return n.links}function a(n,t){const o=n.get(t);if(!o)throw new Error("missing: "+t);return o}function d({nodes:n}){for(const t of n){let n=t.y0,o=n;for(const o of t.sourceLinks)o.y0=n+o.width/2,n+=o.width;for(const n of t.targetLinks)n.y1=o+n.width/2,o+=n.width}}HTMLWidgets,HTMLWidgets.widget({name:"sankey",type:"output",factory:function(g,h,y){return{renderValue:function(g){const k=g.data,L=function(){let g,h,y,k=0,L=0,w=1,p=1,v=24,x=8,m=u,M=o,b=c,S=l,j=6;function z(){const o={nodes:b.apply(null,arguments),links:S.apply(null,arguments)};return function({nodes:n,links:t}){for(const[t,o]of n.entries())o.index=t,o.sourceLinks=[],o.targetLinks=[];const o=new Map(n.map(((t,o)=>[m(t,o,n),t])));for(const[n,e]of t.entries()){e.index=n;let{source:t,target:r}=e;"object"!=typeof t&&(t=e.source=a(o,t)),"object"!=typeof r&&(r=e.target=a(o,r)),t.sourceLinks.push(e),r.targetLinks.push(e)}if(null!=y)for(const{sourceLinks:t,targetLinks:o}of n)t.sort(y),o.sort(y)}(o),function({nodes:t}){for(const o of t)o.value=void 0===o.fixedValue?Math.max(n(o.sourceLinks,s),n(o.targetLinks,s)):o.fixedValue}(o),function({nodes:n}){const t=n.length;let o=new Set(n),e=new Set,r=0;for(;o.size;){for(const n of o){n.depth=r;for(const{target:t}of n.sourceLinks)e.add(t)}if(++r>t)throw new Error("circular link");o=e,e=new Set}}(o),function({nodes:n}){const t=n.length;let o=new Set(n),e=new Set,r=0;for(;o.size;){for(const n of o){n.height=r;for(const{source:t}of n.targetLinks)e.add(t)}if(++r>t)throw new Error("circular link");o=e,e=new Set}}(o),function(o){const e=function({nodes:n}){const o=t(n,(n=>n.depth))+1,e=(w-k-v)/(o-1),r=new Array(o);for(const t of n){const n=Math.max(0,Math.min(o-1,Math.floor(M.call(null,t,o))));t.layer=n,t.x0=k+n*e,t.x1=t.x0+v,r[n]?r[n].push(t):r[n]=[t]}if(h)for(const n of r)n.sort(h);return r}(o);g=Math.min(x,(p-L)/(t(e,(n=>n.length))-1)),function(t){const o=function(n,t){let o;if(void 0===t)for(const t of n)null!=t&&(o>t||void 0===o&&t>=t)&&(o=t);else{let e=-1;for(let r of n)null!=(r=t(r,++e))&&(o>r||void 0===o&&r>=r)&&(o=r)}return o}(t,(t=>(p-L-(t.length-1)*g)/n(t,s)));for(const n of t){let t=L;for(const e of n){e.y0=t,e.y1=t+e.value*o,t=e.y1+g;for(const n of e.sourceLinks)n.width=n.value*o}t=(p-t+g)/(n.length+1);for(let o=0;o<n.length;++o){const e=n[o];e.y0+=t*(o+1),e.y1+=t*(o+1)}O(n)}}(e);for(let n=0;n<j;++n){const t=Math.pow(.99,n),o=Math.max(1-t,(n+1)/j);W(e,t,o),A(e,t,o)}}(o),d(o),o}function A(n,t,o){for(let e=1,r=n.length;e<r;++e){const r=n[e];for(const n of r){let o=0,e=0;for(const{source:t,value:r}of n.targetLinks){let i=r*(n.layer-t.layer);o+=P(t,n)*i,e+=i}if(!(e>0))continue;let r=(o/e-n.y0)*t;n.y0+=r,n.y1+=r,I(n)}void 0===h&&r.sort(f),E(r,o)}}function W(n,t,o){for(let e=n.length-2;e>=0;--e){const r=n[e];for(const n of r){let o=0,e=0;for(const{target:t,value:r}of n.sourceLinks){let i=r*(t.layer-n.layer);o+=T(n,t)*i,e+=i}if(!(e>0))continue;let r=(o/e-n.y0)*t;n.y0+=r,n.y1+=r,I(n)}void 0===h&&r.sort(f),E(r,o)}}function E(n,t){const o=n.length>>1,e=n[o];H(n,e.y0-g,o-1,t),V(n,e.y1+g,o+1,t),H(n,p,n.length-1,t),V(n,L,0,t)}function V(n,t,o,e){for(;o<n.length;++o){const r=n[o],i=(t-r.y0)*e;i>1e-6&&(r.y0+=i,r.y1+=i),t=r.y1+g}}function H(n,t,o,e){for(;o>=0;--o){const r=n[o],i=(r.y1-t)*e;i>1e-6&&(r.y0-=i,r.y1-=i),t=r.y0-g}}function I({sourceLinks:n,targetLinks:t}){if(void 0===y){for(const{source:{sourceLinks:n}}of t)n.sort(i);for(const{target:{targetLinks:t}}of n)t.sort(r)}}function O(n){if(void 0===y)for(const{sourceLinks:t,targetLinks:o}of n)t.sort(i),o.sort(r)}function P(n,t){let o=n.y0-(n.sourceLinks.length-1)*g/2;for(const{target:e,width:r}of n.sourceLinks){if(e===t)break;o+=r+g}for(const{source:e,width:r}of t.targetLinks){if(e===n)break;o-=r}return o}function T(n,t){let o=t.y0-(t.targetLinks.length-1)*g/2;for(const{source:e,width:r}of t.targetLinks){if(e===n)break;o+=r+g}for(const{target:e,width:r}of n.sourceLinks){if(e===t)break;o-=r}return o}return z.update=function(n){return d(n),n},z.nodeId=function(n){return arguments.length?(m="function"==typeof n?n:e(n),z):m},z.nodeAlign=function(n){return arguments.length?(M="function"==typeof n?n:e(n),z):M},z.nodeSort=function(n){return arguments.length?(h=n,z):h},z.nodeWidth=function(n){return arguments.length?(v=+n,z):v},z.nodePadding=function(n){return arguments.length?(x=g=+n,z):x},z.nodes=function(n){return arguments.length?(b="function"==typeof n?n:e(n),z):b},z.links=function(n){return arguments.length?(S="function"==typeof n?n:e(n),z):S},z.linkSort=function(n){return arguments.length?(y=n,z):y},z.size=function(n){return arguments.length?(k=L=0,w=+n[0],p=+n[1],z):[w-k,p-L]},z.extent=function(n){return arguments.length?(k=+n[0][0],w=+n[1][0],L=+n[0][1],p=+n[1][1],z):[[k,L],[w,p]]},z.iterations=function(n){return arguments.length?(j=+n,z):j},z}().nodeId((n=>n.name)).nodeAlign(d3[nodeAlign]).nodeWidth(15).nodePadding(10).extent([[1,5],[h-1,y-5]]),{nodes:w,links:p}=L({nodes:k.nodes.map((n=>Object.assign({},n))),links:k.links.map((n=>Object.assign({},n)))})},resize:function(n,t){}}}})})();